import React, { useState, useEffect } from 'react';
import { useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import {
  Container,
  Row,
  Col,
  Card,
  Nav,
  Tab,
  Table,
  Button,
  Alert,
  Badge,
  Form,
  Modal,
  Spinner
} from 'react-bootstrap';
import { adminService } from '../services/adminService';
import './AdminPage.css';

const AdminPage = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [dashboardData, setDashboardData] = useState(null);
  const [users, setUsers] = useState([]);
  const [posts, setPosts] = useState([]);
  const [comments, setComments] = useState([]);
  const [systemSettings, setSystemSettings] = useState({});
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [success, setSuccess] = useState('');
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [deleteTarget, setDeleteTarget] = useState(null);
  
  const { user } = useSelector(state => state.auth);
  const navigate = useNavigate();

  // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
  useEffect(() => {
    checkAdminAccess();
  }, [user, navigate]);

  const checkAdminAccess = async () => {
    try {
      // ÏÑúÎ≤ÑÏóêÏÑú Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
      const token = localStorage.getItem('token');
      if (!token) {
        console.log('‚ùå ÌÜ†ÌÅ∞ ÏóÜÏùå, ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏');
        navigate('/');
        return;
      }

      const response = await fetch('http://localhost:5000/api/auth/menu-permissions', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      if (response.ok) {
        const data = await response.json();
        console.log('üîç ÏÑúÎ≤Ñ Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏:', data);
        
        if (data.hasAdminAccess) {
          console.log('‚úÖ ÏÑúÎ≤ÑÏóêÏÑú Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏Îê®');
          loadDashboard();
        } else {
          console.log('‚ùå ÏÑúÎ≤ÑÏóêÏÑú Í¥ÄÎ¶¨Ïûê Í∂åÌïú Í±∞Î∂Ä, ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏');
          navigate('/');
        }
      } else {
        console.log('‚ùå ÏÑúÎ≤Ñ Í∂åÌïú ÌôïÏù∏ Ïã§Ìå®, ÌôàÏúºÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏');
        navigate('/');
      }
    } catch (error) {
      console.error('Í∂åÌïú ÌôïÏù∏ Ïò§Î•ò:', error);
      navigate('/');
    }
  };

  // ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
  const loadDashboard = async () => {
    try {
      setLoading(true);
      setError('');
      const response = await adminService.getDashboard();
      setDashboardData(response.data);
    } catch (error) {
      console.error('Dashboard load error:', error);
      if (error.response?.status === 401 || error.response?.status === 403) {
        navigate('/');
        return;
      }
      setError('ÎåÄÏãúÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  // ÏÇ¨Ïö©Ïûê Î™©Î°ù Î°úÎìú
  const loadUsers = async () => {
    try {
      setLoading(true);
      setError('');
      const response = await adminService.getUsers();
      setUsers(response.data.users);
    } catch (error) {
      console.error('Users load error:', error);
      if (error.response?.status === 401 || error.response?.status === 403) {
        navigate('/');
        return;
      }
      setError('ÏÇ¨Ïö©Ïûê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  // Í≤åÏãúÎ¨º Î™©Î°ù Î°úÎìú
  const loadPosts = async () => {
    try {
      setLoading(true);
      const response = await adminService.getPosts();
      setPosts(response.data.posts);
    } catch (error) {
      setError('Í≤åÏãúÎ¨º Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  // ÎåìÍ∏Ä Î™©Î°ù Î°úÎìú
  const loadComments = async () => {
    try {
      setLoading(true);
      const response = await adminService.getComments();
      setComments(response.data.comments);
    } catch (error) {
      setError('ÎåìÍ∏Ä Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  // ÏãúÏä§ÌÖú ÏÑ§Ï†ï Î°úÎìú
  const loadSystemSettings = async () => {
    try {
      setLoading(true);
      const response = await adminService.getSystemSettings();
      setSystemSettings(response.data);
    } catch (error) {
      setError('ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    } finally {
      setLoading(false);
    }
  };

  // ÌÉ≠ Î≥ÄÍ≤Ω Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
  const handleTabSelect = (tab) => {
    setActiveTab(tab);
    setError('');
    setSuccess('');
    
    switch (tab) {
      case 'dashboard':
        loadDashboard();
        break;
      case 'users':
        loadUsers();
        break;
      case 'posts':
        loadPosts();
        break;
      case 'comments':
        loadComments();
        break;
      case 'settings':
        loadSystemSettings();
        break;
      default:
        break;
    }
  };

  // ÏÇ¨Ïö©Ïûê Ïó≠Ìï† Î≥ÄÍ≤Ω
  const handleUserRoleChange = async (userId, newRole) => {
    try {
      await adminService.updateUserRole(userId, newRole);
      setSuccess('ÏÇ¨Ïö©Ïûê Ïó≠Ìï†Ïù¥ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
      loadUsers();
    } catch (error) {
      setError('ÏÇ¨Ïö©Ïûê Ïó≠Ìï† Î≥ÄÍ≤ΩÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÏÇ¨Ïö©Ïûê ÏÉÅÌÉú ÌÜ†Í∏Ä
  const handleUserStatusToggle = async (userId, active) => {
    try {
      await adminService.toggleUserStatus(userId, active);
      setSuccess(active ? 'ÏÇ¨Ïö©ÏûêÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§.' : 'ÏÇ¨Ïö©ÏûêÍ∞Ä ÎπÑÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§.');
      loadUsers();
    } catch (error) {
      setError('ÏÇ¨Ïö©Ïûê ÏÉÅÌÉú Î≥ÄÍ≤ΩÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
  const handleUserDelete = async (userId) => {
    try {
      await adminService.deleteUser(userId);
      setSuccess('ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      loadUsers();
    } catch (error) {
      setError('ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî
  const handlePasswordReset = async (userId, username) => {
    try {
      const response = await adminService.resetUserPassword(userId);
      if (response.success && response.data?.newPassword) {
        setSuccess(`${username}ÎãòÏùò ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä "${response.data.newPassword}"Î°ú Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.`);
      } else {
        setError('ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî ÏùëÎãµÏùÑ Î∞õÏßÄ Î™ªÌñàÏäµÎãàÎã§.');
      }
    } catch (error) {
      console.error('Password reset error:', error);
      setError('ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨
  const showDeleteConfirm = (type, id, title) => {
    setDeleteTarget({ type, id, title });
    setShowDeleteModal(true);
  };

  // Ïã§Ï†ú ÏÇ≠Ï†ú Ï≤òÎ¶¨
  const handleDelete = async () => {
    try {
      const { type, id } = deleteTarget;
      
      if (type === 'post') {
        await adminService.deletePost(id);
        setSuccess('Í≤åÏãúÎ¨ºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        loadPosts();
      } else if (type === 'comment') {
        await adminService.deleteComment(id);
        setSuccess('ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        loadComments();
      } else if (type === 'user') {
        await adminService.deleteUser(id);
        setSuccess('ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        loadUsers();
      }
      
      setShowDeleteModal(false);
      setDeleteTarget(null);
    } catch (error) {
      setError('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÏãúÏä§ÌÖú ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
  const handleSettingsUpdate = async (e) => {
    e.preventDefault();
    try {
      await adminService.updateSystemSettings(systemSettings);
      setSuccess('ÏãúÏä§ÌÖú ÏÑ§Ï†ïÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.');
    } catch (error) {
      setError('ÏãúÏä§ÌÖú ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    }
  };

  // ÎÇ†Ïßú Ìè¨Îß∑
  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  // ÎåÄÏãúÎ≥¥Îìú Î†åÎçîÎßÅ
  const renderDashboard = () => (
    <Row>
      <Col md={3} className="mb-3">
        <Card className="admin-stat-card">
          <Card.Body>
            <div className="d-flex justify-content-between">
              <div>
                <h6 className="text-muted">Ï¥ù ÏÇ¨Ïö©Ïûê</h6>
                <h3 className="text-primary">{dashboardData?.userStats?.total_users || 0}</h3>
                <small className="text-success">
                  Ïù¥Î≤à Ï£º +{dashboardData?.userStats?.new_users_week || 0}
                </small>
              </div>
              <div className="admin-stat-icon bg-primary">
                <i className="fas fa-users"></i>
              </div>
            </div>
          </Card.Body>
        </Card>
      </Col>
      
      <Col md={3} className="mb-3">
        <Card className="admin-stat-card">
          <Card.Body>
            <div className="d-flex justify-content-between">
              <div>
                <h6 className="text-muted">Ï¥ù Í≤åÏãúÎ¨º</h6>
                <h3 className="text-info">{dashboardData?.postStats?.total_posts || 0}</h3>
                <small className="text-success">
                  Ïù¥Î≤à Ï£º +{dashboardData?.postStats?.new_posts_week || 0}
                </small>
              </div>
              <div className="admin-stat-icon bg-info">
                <i className="fas fa-edit"></i>
              </div>
            </div>
          </Card.Body>
        </Card>
      </Col>
      
      <Col md={3} className="mb-3">
        <Card className="admin-stat-card">
          <Card.Body>
            <div className="d-flex justify-content-between">
              <div>
                <h6 className="text-muted">Ï¥ù ÎåìÍ∏Ä</h6>
                <h3 className="text-warning">{dashboardData?.commentStats?.total_comments || 0}</h3>
                <small className="text-success">
                  Ïù¥Î≤à Ï£º +{dashboardData?.commentStats?.new_comments_week || 0}
                </small>
              </div>
              <div className="admin-stat-icon bg-warning">
                <i className="fas fa-comments"></i>
              </div>
            </div>
          </Card.Body>
        </Card>
      </Col>
      
      <Col md={3} className="mb-3">
        <Card className="admin-stat-card">
          <Card.Body>
            <div className="d-flex justify-content-between">
              <div>
                <h6 className="text-muted">Í¥ÄÎ¶¨Ïûê</h6>
                <h3 className="text-danger">{dashboardData?.userStats?.admin_users || 0}</h3>
                <small className="text-muted">ÌôúÏÑ± Í¥ÄÎ¶¨Ïûê</small>
              </div>
              <div className="admin-stat-icon bg-danger">
                <i className="fas fa-user-shield"></i>
              </div>
            </div>
          </Card.Body>
        </Card>
      </Col>
      
      <Col md={12}>
        <Card>
          <Card.Header>
            <h5>ÏµúÍ∑º ÌôúÎèô</h5>
          </Card.Header>
          <Card.Body>
            <Table responsive hover>
              <thead>
                <tr>
                  <th>Ïú†Ìòï</th>
                  <th>ÎÇ¥Ïö©</th>
                  <th>ÏûëÏÑ±Ïûê</th>
                  <th>ÏãúÍ∞Ñ</th>
                </tr>
              </thead>
              <tbody>
                {dashboardData?.recentActivity?.map((activity, index) => (
                  <tr key={index}>
                    <td>
                      <Badge bg={activity.type === 'post' ? 'primary' : 'secondary'}>
                        {activity.type === 'post' ? 'Í≤åÏãúÎ¨º' : 'ÎåìÍ∏Ä'}
                      </Badge>
                    </td>
                    <td>{activity.content}</td>
                    <td>{activity.username}</td>
                    <td>{formatDate(activity.created_at)}</td>
                  </tr>
                ))}
              </tbody>
            </Table>
          </Card.Body>
        </Card>
      </Col>
    </Row>
  );

  // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î†åÎçîÎßÅ
  const renderUsers = () => (
    <Card>
      <Card.Header>
        <h5>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h5>
      </Card.Header>
      <Card.Body>
        <Table responsive hover>
          <thead>
            <tr>
              <th>ID</th>
              <th>ÏÇ¨Ïö©ÏûêÎ™Ö</th>
              <th>Ïù¥Î©îÏùº</th>
              <th>Ïó≠Ìï†</th>
              <th>Í≤åÏãúÎ¨º</th>
              <th>ÎåìÍ∏Ä</th>
              <th>Í∞ÄÏûÖÏùº</th>
              <th>Ïï°ÏÖò</th>
            </tr>
          </thead>
          <tbody>
            {users.map(user => (
              <tr key={user.id}>
                <td>{user.id}</td>
                <td>{user.username}</td>
                <td>{user.email}</td>
                <td>
                  <Badge bg={user.role === 'admin' ? 'danger' : 'primary'}>
                    {user.role === 'admin' ? 'Í¥ÄÎ¶¨Ïûê' : 'ÏÇ¨Ïö©Ïûê'}
                  </Badge>
                </td>
                <td>{user.post_count}</td>
                <td>{user.comment_count}</td>
                <td>{formatDate(user.created_at)}</td>
                <td>
                  <div className="d-flex gap-2">
                    <Form.Select 
                      size="sm" 
                      value={user.role}
                      onChange={(e) => handleUserRoleChange(user.id, e.target.value)}
                      style={{ width: '120px' }}
                    >
                      <option value="user">ÏÇ¨Ïö©Ïûê</option>
                      <option value="admin">Í¥ÄÎ¶¨Ïûê</option>
                    </Form.Select>
                    <Button 
                      variant={user.is_active ? 'outline-warning' : 'outline-success'} 
                      size="sm"
                      onClick={() => handleUserStatusToggle(user.id, !user.is_active)}
                    >
                      {user.is_active ? 'ÎπÑÌôúÏÑ±Ìôî' : 'ÌôúÏÑ±Ìôî'}
                    </Button>
                    <Button 
                      variant="outline-info" 
                      size="sm"
                      onClick={() => handlePasswordReset(user.id, user.username)}
                    >
                      ÎπÑÎ∞ÄÎ≤àÌò∏ Ï¥àÍ∏∞Ìôî
                    </Button>
                    {user.role !== 'admin' && (
                      <Button 
                        variant="outline-danger" 
                        size="sm"
                        onClick={() => showDeleteConfirm('user', user.id, user.username)}
                      >
                        ÏÇ≠Ï†ú
                      </Button>
                    )}
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </Table>
      </Card.Body>
    </Card>
  );

  // Í≤åÏãúÎ¨º Í¥ÄÎ¶¨ Î†åÎçîÎßÅ
  const renderPosts = () => (
    <Card>
      <Card.Header>
        <h5>Í≤åÏãúÎ¨º Í¥ÄÎ¶¨</h5>
      </Card.Header>
      <Card.Body>
        <Table responsive hover>
          <thead>
            <tr>
              <th>ID</th>
              <th>Ï†úÎ™©</th>
              <th>ÏûëÏÑ±Ïûê</th>
              <th>Ï¢ãÏïÑÏöî</th>
              <th>ÎåìÍ∏Ä</th>
              <th>ÏûëÏÑ±Ïùº</th>
              <th>Ïï°ÏÖò</th>
            </tr>
          </thead>
          <tbody>
            {posts.map(post => (
              <tr key={post.id}>
                <td>{post.id}</td>
                <td>{post.title}</td>
                <td>{post.author}</td>
                <td>{post.like_count}</td>
                <td>{post.comment_count}</td>
                <td>{formatDate(post.created_at)}</td>
                <td>
                  <Button 
                    variant="outline-danger" 
                    size="sm"
                    onClick={() => showDeleteConfirm('post', post.id, post.title)}
                  >
                    ÏÇ≠Ï†ú
                  </Button>
                </td>
              </tr>
            ))}
          </tbody>
        </Table>
      </Card.Body>
    </Card>
  );

  // ÎåìÍ∏Ä Í¥ÄÎ¶¨ Î†åÎçîÎßÅ
  const renderComments = () => (
    <Card>
      <Card.Header>
        <h5>ÎåìÍ∏Ä Í¥ÄÎ¶¨</h5>
      </Card.Header>
      <Card.Body>
        <Table responsive hover>
          <thead>
            <tr>
              <th>ID</th>
              <th>ÎÇ¥Ïö©</th>
              <th>ÏûëÏÑ±Ïûê</th>
              <th>Í≤åÏãúÎ¨º</th>
              <th>ÏûëÏÑ±Ïùº</th>
              <th>Ïï°ÏÖò</th>
            </tr>
          </thead>
          <tbody>
            {comments.map(comment => (
              <tr key={comment.id}>
                <td>{comment.id}</td>
                <td>{comment.content.substring(0, 50)}...</td>
                <td>{comment.author}</td>
                <td>{comment.post_title}</td>
                <td>{formatDate(comment.created_at)}</td>
                <td>
                  <Button 
                    variant="outline-danger" 
                    size="sm"
                    onClick={() => showDeleteConfirm('comment', comment.id, comment.content)}
                  >
                    ÏÇ≠Ï†ú
                  </Button>
                </td>
              </tr>
            ))}
          </tbody>
        </Table>
      </Card.Body>
    </Card>
  );

  // ÏãúÏä§ÌÖú ÏÑ§Ï†ï Î†åÎçîÎßÅ
  const renderSettings = () => (
    <Card>
      <Card.Header>
        <h5>ÏãúÏä§ÌÖú ÏÑ§Ï†ï</h5>
      </Card.Header>
      <Card.Body>
        <Form onSubmit={handleSettingsUpdate}>
          <Row>
            <Col md={6}>
              <Form.Group className="mb-3">
                <Form.Label>ÏÇ¨Ïù¥Ìä∏ Ïù¥Î¶Ñ</Form.Label>
                <Form.Control
                  type="text"
                  value={systemSettings.siteName || ''}
                  onChange={(e) => setSystemSettings({...systemSettings, siteName: e.target.value})}
                />
              </Form.Group>
            </Col>
            <Col md={6}>
              <Form.Group className="mb-3">
                <Form.Label>ÏµúÎåÄ Í≤åÏãúÎ¨º Í∏∏Ïù¥</Form.Label>
                <Form.Control
                  type="number"
                  value={systemSettings.maxPostLength || ''}
                  onChange={(e) => setSystemSettings({...systemSettings, maxPostLength: parseInt(e.target.value)})}
                />
              </Form.Group>
            </Col>
          </Row>
          
          <Row>
            <Col md={6}>
              <Form.Group className="mb-3">
                <Form.Label>ÏµúÎåÄ ÎåìÍ∏Ä Í∏∏Ïù¥</Form.Label>
                <Form.Control
                  type="number"
                  value={systemSettings.maxCommentLength || ''}
                  onChange={(e) => setSystemSettings({...systemSettings, maxCommentLength: parseInt(e.target.value)})}
                />
              </Form.Group>
            </Col>
            <Col md={6}>
              <Form.Group className="mb-3">
                <Form.Label>ÏµúÎåÄ ÌååÏùº ÌÅ¨Í∏∞ (MB)</Form.Label>
                <Form.Control
                  type="number"
                  value={systemSettings.maxFileSize || ''}
                  onChange={(e) => setSystemSettings({...systemSettings, maxFileSize: parseInt(e.target.value)})}
                />
              </Form.Group>
            </Col>
          </Row>
          
          <Button type="submit" variant="primary">
            ÏÑ§Ï†ï Ï†ÄÏû•
          </Button>
        </Form>
      </Card.Body>
    </Card>
  );

  // ReduxÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏúºÎ©¥ localStorageÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
  let currentUser = user;
  if (!currentUser) {
    try {
      const storedUser = localStorage.getItem('user');
      if (storedUser) {
        currentUser = JSON.parse(storedUser);
      }
    } catch (error) {
      console.error('Error parsing stored user:', error);
    }
  }

  // üö® Prototype Pollution Ï∑®ÏïΩÏ†ê: isAdmin ÏÜçÏÑ±ÎèÑ Ï≤¥ÌÅ¨
  const hasAdminRole = currentUser?.role === 'admin';
  const hasAdminFromPrototype = currentUser?.isAdmin;
  
  // Ïª¥Ìè¨ÎÑåÌä∏ Î†åÎçî ÏãúÏ†êÏóêÏÑúÎäî Î°úÎî© ÏÉÅÌÉúÎßå Ï≤¥ÌÅ¨
  return (
    <Container fluid className="admin-page">
      <Row>
        <Col md={12}>
          <div className="admin-header mb-4">
            <h2>
              <i className="fas fa-cogs me-2"></i>
              CoinTalk Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê
            </h2>
            <p className="text-muted">ÏãúÏä§ÌÖú Ï†ÑÎ∞òÏùÑ Í¥ÄÎ¶¨ÌïòÍ≥† Î™®ÎãàÌÑ∞ÎßÅÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
          </div>
          
          {error && <Alert variant="danger" onClose={() => setError('')} dismissible>{error}</Alert>}
          {success && <Alert variant="success" onClose={() => setSuccess('')} dismissible>{success}</Alert>}
          
          <Tab.Container activeKey={activeTab} onSelect={handleTabSelect}>
            <Nav variant="tabs" className="admin-nav-tabs mb-4">
              <Nav.Item>
                <Nav.Link eventKey="dashboard">
                  <i className="fas fa-tachometer-alt me-2"></i>ÎåÄÏãúÎ≥¥Îìú
                </Nav.Link>
              </Nav.Item>
              <Nav.Item>
                <Nav.Link eventKey="users">
                  <i className="fas fa-users me-2"></i>ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨
                </Nav.Link>
              </Nav.Item>
              <Nav.Item>
                <Nav.Link eventKey="posts">
                  <i className="fas fa-edit me-2"></i>Í≤åÏãúÎ¨º Í¥ÄÎ¶¨
                </Nav.Link>
              </Nav.Item>
              <Nav.Item>
                <Nav.Link eventKey="comments">
                  <i className="fas fa-comments me-2"></i>ÎåìÍ∏Ä Í¥ÄÎ¶¨
                </Nav.Link>
              </Nav.Item>
              <Nav.Item>
                <Nav.Link eventKey="settings">
                  <i className="fas fa-cog me-2"></i>ÏãúÏä§ÌÖú ÏÑ§Ï†ï
                </Nav.Link>
              </Nav.Item>
            </Nav>
            
            <Tab.Content>
              {loading ? (
                <div className="text-center py-5">
                  <Spinner animation="border" role="status">
                    <span className="visually-hidden">Î°úÎî© Ï§ë...</span>
                  </Spinner>
                </div>
              ) : (
                <>
                  <Tab.Pane eventKey="dashboard">
                    {dashboardData && renderDashboard()}
                  </Tab.Pane>
                  <Tab.Pane eventKey="users">
                    {renderUsers()}
                  </Tab.Pane>
                  <Tab.Pane eventKey="posts">
                    {renderPosts()}
                  </Tab.Pane>
                  <Tab.Pane eventKey="comments">
                    {renderComments()}
                  </Tab.Pane>
                  <Tab.Pane eventKey="settings">
                    {renderSettings()}
                  </Tab.Pane>
                </>
              )}
            </Tab.Content>
          </Tab.Container>
        </Col>
      </Row>
      
      {/* ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ */}
      <Modal show={showDeleteModal} onHide={() => setShowDeleteModal(false)}>
        <Modal.Header closeButton>
          <Modal.Title>ÏÇ≠Ï†ú ÌôïÏù∏</Modal.Title>
        </Modal.Header>
        <Modal.Body>
          Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
          <br />
          <strong>{deleteTarget?.title}</strong>
        </Modal.Body>
        <Modal.Footer>
          <Button variant="secondary" onClick={() => setShowDeleteModal(false)}>
            Ï∑®ÏÜå
          </Button>
          <Button variant="danger" onClick={handleDelete}>
            ÏÇ≠Ï†ú
          </Button>
        </Modal.Footer>
      </Modal>
    </Container>
  );
};

export default AdminPage;
